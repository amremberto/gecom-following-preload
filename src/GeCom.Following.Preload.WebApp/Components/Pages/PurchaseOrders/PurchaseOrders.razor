@page "/purchase-orders"
@rendermode InteractiveServer
@attribute [Microsoft.AspNetCore.Authorization.Authorize]
@using GeCom.Following.Preload.Contracts.Spd_Sap.SapPurchaseOrders

<PageTitle>Órdenes de Compra</PageTitle>

<Topbar title="Órdenes de Compra" />

@if (_isLoading)
{
    <div class="text-center py-2">
        <button class="btn btn-primary" type="button" disabled>
            <span class="spinner-border spinner-border-sm me-1" role="status"
                  aria-hidden="true"></span>
            Cargando datos....
        </button>
    </div>
}

<!-- Purchase Orders Tabs -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                @if (_isDataTableLoading)
                {
                    <div class="text-center py-2">
                        <button class="btn btn-primary" type="button" disabled>
                            <span class="spinner-border spinner-border-sm me-1" role="status"
                                  aria-hidden="true"></span>
                            Cargando datos...
                        </button>
                    </div>
                }
                <div class="d-flex justify-content-between align-items-start mb-3">
                    <ul class="nav nav-tabs" id="purchaseOrdersTab" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="purchase-orders-tab" data-bs-toggle="tab" data-bs-target="#purchaseOrders" type="button" role="tab" aria-controls="purchaseOrders" aria-selected="true" style="color: #8B4513 !important;">
                                <i class="ri-shopping-cart-line" style="color: #8B4513;"></i> Órdenes de Compra SAP
                            </button>
                        </li>
                    </ul>
                </div>
                <div class="tab-content">
                    <!-- Tab Órdenes de Compra -->
                    <div class="tab-pane fade show active" id="purchaseOrders" role="tabpanel" aria-labelledby="purchase-orders-tab">
                        <table id="purchase-orders-datatable" class="table table-striped w-100 nowrap">
                    <thead>
                        <tr>
                            <th>Nro. Documento</th>
                            <th>Posición</th>
                            <th>Descripción</th>
                            @if (!_isProvider)
                            {
                                <th>Proveedor</th>
                            }
                            <th>Empresa</th>
                            <th>Cantidad Pedida</th>
                            <th>Cantidad Entregada</th>
                            <th>Cantidad Facturada</th>
                            <th>Importe Original</th>
                            <th>Moneda</th>
                            <th>Neto Anticipo</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var po in _purchaseOrders)
                        {
                            <tr>
                                <td>@po.Nrodocumento</td>
                                <td>@po.Posicion</td>
                                <td>@(po.Textobreve ?? "-")</td>
                                @if (!_isProvider)
                                {
                                    <td>@po.Proveedor</td>
                                }
                                <td>@(po.Empresa ?? "-")</td>
                                <td class="text-end">@po.Cantidadpedida.ToString("N2")</td>
                                <td class="text-end">@po.Cantidadentregada.ToString("N2")</td>
                                <td class="text-end">@po.Cantidadfacturada.ToString("N2")</td>
                                <td class="text-end">@po.Importeoriginal.ToString("N2")</td>
                                <td>@(po.Moneda ?? "-")</td>
                                <td class="text-end">@(po.NetoAnticipo?.ToString("N2") ?? "-")</td>
                            </tr>
                        }
                    </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Purchase Orders Tabs -->

<Toast @ref="_toast" />
