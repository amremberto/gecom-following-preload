{"version":3,"file":"form-wizard-edit.min.js","names":["validateFirstTabFields","form","document","getElementById","isValid","querySelectorAll","forEach","input","offsetParent","disabled","tagName","$","data","value","val","classList","remove","add","id","digitsOnly","replace","trim","length","nextElementSibling","contains","textContent","flatpickrInput","querySelector","_flatpickr","altInput","dateValue","dateValid","selectedDates","fechaFacturaDate","today","Date","setHours","setCustomValidity","fechaFacturaInput","vencCaecaiDate","type","parseFloat","updateTabsState","wizardElement","isPendingPreload","navLinks","i","style","pointerEvents","opacity","cursor","updateWarningAlertVisibility","warningAlert","display","validateCaecaiField","hasAttribute","feedback","validateField","checkValidity","setupFormValidation","on","selectElement","this","setTimeout","addEventListener","e","substring","char","String","fromCharCode","which","test","preventDefault","config","onChange","push","vencInput","set","$select","showValidationToast","dotNetReference","message","invokeMethodAsync","catch","error","console","alert","setupNavigationRestrictions","validationMessage","link","index","stopPropagation","stopImmediatePropagation","nextButton","activeTab","getAttribute","target","updateSaveButtonVisibility","saveButtonContainer","activeTabHref","setupSaveButtonVisibility","window","initEditDocumentWizard","initWizard","warn","Wizard","validate","log","attempts","interval","setInterval","clearInterval","resetEditDocumentWizard","firstTab","firstTabPane","pane"],"sources":["form-wizard-edit.js"],"mappings":"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","ignoreList":[],"sourcesContent":["/**\r\n * Theme: Adminto - Responsive Bootstrap 5 Admin Dashboard\r\n * Author: Coderthemes\r\n * Module/App: Form Wizard with Validation for Edit Document Modal\r\n */\r\n\r\n/**\r\n * Validates all required fields in the first tab of the document properties form\r\n * @returns {boolean} True if all required fields are valid, false otherwise\r\n */\r\nfunction validateFirstTabFields() {\r\n    var form = document.getElementById('documentPropertiesForm');\r\n    if (!form) return false;\r\n\r\n    var isValid = true;\r\n    var requiredInputs = form.querySelectorAll('input[required], select[required]');\r\n\r\n    requiredInputs.forEach(function (input) {\r\n        // Skip validation for hidden or disabled fields\r\n        if (input.offsetParent === null || input.disabled) {\r\n            return;\r\n        }\r\n\r\n        // For SELECT2 selects, get value from SELECT2\r\n        if (input.tagName === 'SELECT' && typeof $ !== 'undefined' && $(input).data('select2')) {\r\n            var value = $(input).val();\r\n            if (!value || value === '' || value === null) {\r\n                isValid = false;\r\n                input.classList.add('is-invalid');\r\n                input.classList.remove('is-valid');\r\n            } else {\r\n                input.classList.remove('is-invalid');\r\n                input.classList.add('is-valid');\r\n            }\r\n        } else {\r\n            // For regular inputs\r\n            var value = input.value;\r\n            \r\n            // Special validation for CAE/CAI field - must have exactly 14 digits\r\n            if (input.id === 'caecai-edit') {\r\n                // Remove non-digit characters for validation\r\n                var digitsOnly = value.replace(/\\D/g, '');\r\n                if (!value || value.trim() === '' || digitsOnly.length !== 14) {\r\n                    isValid = false;\r\n                    input.classList.add('is-invalid');\r\n                    input.classList.remove('is-valid');\r\n                    if (input.nextElementSibling && input.nextElementSibling.classList.contains('invalid-feedback')) {\r\n                        input.nextElementSibling.textContent = 'El nro. CAE/CAI debe tener exactamente 14 dígitos.';\r\n                    }\r\n                } else {\r\n                    input.classList.remove('is-invalid');\r\n                    input.classList.add('is-valid');\r\n                }\r\n            }\r\n            // Special validation for date fields using Flatpickr\r\n            else if (input.id === 'fecha-factura-edit' || input.id === 'venc-caecai-edit') {\r\n                // Check if Flatpickr instance exists\r\n                var flatpickrInput = input.id === 'fecha-factura-edit' \r\n                    ? document.querySelector('#fecha-factura-edit')\r\n                    : document.querySelector('#venc-caecai-edit');\r\n                \r\n                if (flatpickrInput && flatpickrInput._flatpickr) {\r\n                    var altInput = flatpickrInput._flatpickr.altInput;\r\n                    if (altInput) {\r\n                        var dateValue = altInput.value;\r\n                        if (!dateValue || dateValue.trim() === '') {\r\n                            isValid = false;\r\n                            altInput.classList.add('is-invalid');\r\n                            altInput.classList.remove('is-valid');\r\n                        } else {\r\n                            // Validate date constraints\r\n                            var dateValid = true;\r\n                            \r\n                            // Validate fecha factura - cannot be greater than today\r\n                            if (input.id === 'fecha-factura-edit') {\r\n                                if (flatpickrInput._flatpickr.selectedDates.length > 0) {\r\n                                    var fechaFacturaDate = flatpickrInput._flatpickr.selectedDates[0];\r\n                                    var today = new Date();\r\n                                    today.setHours(0, 0, 0, 0);\r\n                                    fechaFacturaDate.setHours(0, 0, 0, 0);\r\n                                    if (fechaFacturaDate > today) {\r\n                                        dateValid = false;\r\n                                        altInput.setCustomValidity('La fecha de factura no puede ser mayor al día actual.');\r\n                                    } else {\r\n                                        altInput.setCustomValidity('');\r\n                                    }\r\n                                }\r\n                            }\r\n                            \r\n                            // Validate vencimiento CAE/CAI - cannot be before fecha factura\r\n                            if (input.id === 'venc-caecai-edit') {\r\n                                var fechaFacturaInput = document.querySelector('#fecha-factura-edit');\r\n                                if (fechaFacturaInput && fechaFacturaInput._flatpickr && fechaFacturaInput._flatpickr.selectedDates.length > 0) {\r\n                                    var fechaFacturaDate = fechaFacturaInput._flatpickr.selectedDates[0];\r\n                                    if (flatpickrInput._flatpickr.selectedDates.length > 0) {\r\n                                        var vencCaecaiDate = flatpickrInput._flatpickr.selectedDates[0];\r\n                                        fechaFacturaDate.setHours(0, 0, 0, 0);\r\n                                        vencCaecaiDate.setHours(0, 0, 0, 0);\r\n                                        if (vencCaecaiDate < fechaFacturaDate) {\r\n                                            dateValid = false;\r\n                                            altInput.setCustomValidity('La fecha Venc. CAE/CAI no puede ser anterior a la fecha de factura.');\r\n                                        } else {\r\n                                            altInput.setCustomValidity('');\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            \r\n                            if (!dateValid || altInput.classList.contains('is-invalid')) {\r\n                                isValid = false;\r\n                                altInput.classList.add('is-invalid');\r\n                                altInput.classList.remove('is-valid');\r\n                            } else {\r\n                                altInput.classList.remove('is-invalid');\r\n                                altInput.classList.add('is-valid');\r\n                            }\r\n                        }\r\n                    }\r\n                } else {\r\n                    // Fallback validation if Flatpickr is not initialized\r\n                    if (!value || value.trim() === '') {\r\n                        isValid = false;\r\n                        input.classList.add('is-invalid');\r\n                        input.classList.remove('is-valid');\r\n                    } else {\r\n                        input.classList.remove('is-invalid');\r\n                        input.classList.add('is-valid');\r\n                    }\r\n                }\r\n            }\r\n            else if (input.type === 'number') {\r\n                if (!value || value === '' || parseFloat(value) <= 0) {\r\n                    isValid = false;\r\n                    input.classList.add('is-invalid');\r\n                    input.classList.remove('is-valid');\r\n                } else {\r\n                    input.classList.remove('is-invalid');\r\n                    input.classList.add('is-valid');\r\n                }\r\n            } else {\r\n                if (!value || value.trim() === '') {\r\n                    isValid = false;\r\n                    input.classList.add('is-invalid');\r\n                    input.classList.remove('is-valid');\r\n                } else {\r\n                    input.classList.remove('is-invalid');\r\n                    input.classList.add('is-valid');\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    return isValid;\r\n}\r\n\r\n/**\r\n * Updates the state of tabs (enabled/disabled) based on validation\r\n * @param {HTMLElement} wizardElement - The wizard container element\r\n * @param {boolean} isPendingPreload - Whether the document is in \"Pendiente Precarga\" status\r\n */\r\nfunction updateTabsState(wizardElement, isPendingPreload) {\r\n    if (!isPendingPreload) return;\r\n\r\n    var isValid = validateFirstTabFields();\r\n    var navLinks = wizardElement.querySelectorAll('.nav-link');\r\n\r\n    for (var i = 1; i < navLinks.length; i++) {\r\n        if (isValid) {\r\n            navLinks[i].classList.remove('disabled');\r\n            navLinks[i].style.pointerEvents = '';\r\n            navLinks[i].style.opacity = '';\r\n            navLinks[i].style.cursor = '';\r\n        } else {\r\n            navLinks[i].classList.add('disabled');\r\n            navLinks[i].style.pointerEvents = 'none';\r\n            navLinks[i].style.opacity = '0.5';\r\n            navLinks[i].style.cursor = 'not-allowed';\r\n        }\r\n    }\r\n    \r\n    // Update warning alert visibility\r\n    updateWarningAlertVisibility(isValid);\r\n}\r\n\r\n/**\r\n * Updates the visibility of the first tab warning alert\r\n * @param {boolean} isValid - Whether all required fields are valid\r\n */\r\nfunction updateWarningAlertVisibility(isValid) {\r\n    var warningAlert = document.getElementById('first-tab-warning-alert');\r\n    if (warningAlert) {\r\n        if (isValid) {\r\n            // Hide the alert if all fields are valid\r\n            warningAlert.style.display = 'none';\r\n        } else {\r\n            // Show the alert if any field is invalid\r\n            warningAlert.style.display = 'block';\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Validates the CAE/CAI field - must have exactly 14 digits\r\n * @param {HTMLElement} input - The input element to validate\r\n * @returns {boolean} True if valid, false otherwise\r\n */\r\nfunction validateCaecaiField(input) {\r\n    if (!input || input.id !== 'caecai-edit') {\r\n        return true;\r\n    }\r\n\r\n    var value = input.value || '';\r\n    // Remove non-digit characters for validation\r\n    var digitsOnly = value.replace(/\\D/g, '');\r\n    \r\n    if (!value || value.trim() === '') {\r\n        if (input.hasAttribute('required')) {\r\n            input.setCustomValidity('Por favor ingrese el número de CAE / CAI.');\r\n            input.classList.add('is-invalid');\r\n            input.classList.remove('is-valid');\r\n            return false;\r\n        }\r\n        input.setCustomValidity('');\r\n        input.classList.remove('is-invalid');\r\n        input.classList.remove('is-valid');\r\n        return true;\r\n    }\r\n\r\n    if (digitsOnly.length !== 14) {\r\n        input.setCustomValidity('El nro. CAE/CAI debe tener exactamente 14 dígitos.');\r\n        input.classList.add('is-invalid');\r\n        input.classList.remove('is-valid');\r\n        // Update invalid-feedback message\r\n        var feedback = input.nextElementSibling;\r\n        if (feedback && feedback.classList.contains('invalid-feedback')) {\r\n            feedback.textContent = 'El nro. CAE/CAI debe tener exactamente 14 dígitos.';\r\n        }\r\n        return false;\r\n    }\r\n\r\n    input.setCustomValidity('');\r\n    input.classList.remove('is-invalid');\r\n    input.classList.add('is-valid');\r\n    return true;\r\n}\r\n\r\n/**\r\n * Validates a single field\r\n * @param {HTMLElement} input - The input element to validate\r\n * @returns {boolean} True if valid, false otherwise\r\n */\r\nfunction validateField(input) {\r\n    if (input.hasAttribute('required')) {\r\n        if (input.type === 'text' || input.type === 'number') {\r\n            if (!input.value || input.value.trim() === '') {\r\n                input.setCustomValidity('Este campo es obligatorio');\r\n                input.classList.add('is-invalid');\r\n                input.classList.remove('is-valid');\r\n                return false;\r\n            } else {\r\n                input.setCustomValidity('');\r\n                input.classList.remove('is-invalid');\r\n                if (input.checkValidity()) {\r\n                    input.classList.add('is-valid');\r\n                }\r\n                return true;\r\n            }\r\n        } else if (input.tagName === 'SELECT') {\r\n            if (!input.value || input.value === '') {\r\n                input.setCustomValidity('Por favor seleccione una opción');\r\n                input.classList.add('is-invalid');\r\n                input.classList.remove('is-valid');\r\n                return false;\r\n            } else {\r\n                input.setCustomValidity('');\r\n                input.classList.remove('is-invalid');\r\n                input.classList.add('is-valid');\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return true;\r\n}\r\n\r\n/**\r\n * Sets up validation listeners for form fields\r\n * @param {HTMLElement} form - The form element\r\n * @param {boolean} isPendingPreload - Whether the document is in \"Pendiente Precarga\" status\r\n * @param {HTMLElement} wizardElement - The wizard container element\r\n */\r\nfunction setupFormValidation(form, isPendingPreload, wizardElement) {\r\n    if (!form) return;\r\n\r\n    // Validate all required fields on initialization\r\n    var requiredInputs = form.querySelectorAll('input[required], select[required]');\r\n    requiredInputs.forEach(function (input) {\r\n        // Validate on initialization\r\n        validateField(input);\r\n\r\n        // For SELECT2 selects, listen to SELECT2 events without interfering\r\n        if (input.tagName === 'SELECT' && typeof $ !== 'undefined' && $(input).data('select2')) {\r\n            $(input).on('select2:select select2:clear', function () {\r\n                // Small delay to ensure SELECT2 has updated the native select value\r\n                var selectElement = this;\r\n                setTimeout(function () {\r\n                    validateField(selectElement);\r\n                    if (isPendingPreload) {\r\n                        updateTabsState(wizardElement, isPendingPreload);\r\n                    } else {\r\n                        // Still update warning alert visibility even if not pending preload\r\n                        var isValid = validateFirstTabFields();\r\n                        updateWarningAlertVisibility(isValid);\r\n                    }\r\n                }, 10);\r\n            });\r\n        } else {\r\n            // Special handling for CAE/CAI field - validate 14 digits\r\n            if (input.id === 'caecai-edit') {\r\n                // Only allow digits\r\n                input.addEventListener('input', function (e) {\r\n                    // Remove non-digit characters\r\n                    var value = this.value.replace(/\\D/g, '');\r\n                    // Limit to 14 digits\r\n                    if (value.length > 14) {\r\n                        value = value.substring(0, 14);\r\n                    }\r\n                    this.value = value;\r\n                    validateCaecaiField(this);\r\n                    if (isPendingPreload) {\r\n                        updateTabsState(wizardElement, isPendingPreload);\r\n                    } else {\r\n                        var isValid = validateFirstTabFields();\r\n                        updateWarningAlertVisibility(isValid);\r\n                    }\r\n                });\r\n\r\n                input.addEventListener('blur', function () {\r\n                    validateCaecaiField(this);\r\n                    if (isPendingPreload) {\r\n                        updateTabsState(wizardElement, isPendingPreload);\r\n                    } else {\r\n                        var isValid = validateFirstTabFields();\r\n                        updateWarningAlertVisibility(isValid);\r\n                    }\r\n                });\r\n\r\n                // Prevent non-digit characters on keypress\r\n                input.addEventListener('keypress', function (e) {\r\n                    var char = String.fromCharCode(e.which);\r\n                    if (!/[0-9]/.test(char)) {\r\n                        e.preventDefault();\r\n                    }\r\n                });\r\n            }\r\n            // Special handling for date fields - validate date constraints\r\n            else if (input.id === 'fecha-factura-edit' || input.id === 'venc-caecai-edit') {\r\n                // Date fields are handled by Flatpickr, but we add listeners to the altInput\r\n                setTimeout(function() {\r\n                    var flatpickrInput = input.id === 'fecha-factura-edit' \r\n                        ? document.querySelector('#fecha-factura-edit')\r\n                        : document.querySelector('#venc-caecai-edit');\r\n                    \r\n                    if (flatpickrInput && flatpickrInput._flatpickr && flatpickrInput._flatpickr.altInput) {\r\n                        var altInput = flatpickrInput._flatpickr.altInput;\r\n                        \r\n                        altInput.addEventListener('blur', function () {\r\n                            validateFirstTabFields();\r\n                            if (isPendingPreload) {\r\n                                updateTabsState(wizardElement, isPendingPreload);\r\n                            } else {\r\n                                var isValid = validateFirstTabFields();\r\n                                updateWarningAlertVisibility(isValid);\r\n                            }\r\n                        });\r\n\r\n                        // Listen for changes in fecha-factura to update venc-caecai minDate\r\n                        if (input.id === 'fecha-factura-edit') {\r\n                            flatpickrInput._flatpickr.config.onChange.push(function(selectedDates) {\r\n                                var vencInput = document.querySelector('#venc-caecai-edit');\r\n                                if (vencInput && vencInput._flatpickr && selectedDates.length > 0) {\r\n                                    vencInput._flatpickr.set('minDate', selectedDates[0]);\r\n                                    // Re-validate venc-caecai field\r\n                                    validateFirstTabFields();\r\n                                    if (isPendingPreload) {\r\n                                        updateTabsState(wizardElement, isPendingPreload);\r\n                                    } else {\r\n                                        var isValid = validateFirstTabFields();\r\n                                        updateWarningAlertVisibility(isValid);\r\n                                    }\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                }, 500);\r\n            }\r\n            // For regular inputs and selects without SELECT2\r\n            else {\r\n                input.addEventListener('blur', function () {\r\n                    validateField(this);\r\n                    if (isPendingPreload) {\r\n                        updateTabsState(wizardElement, isPendingPreload);\r\n                    } else {\r\n                        var isValid = validateFirstTabFields();\r\n                        updateWarningAlertVisibility(isValid);\r\n                    }\r\n                });\r\n\r\n                // Validate on input change\r\n                input.addEventListener('input', function () {\r\n                    validateField(this);\r\n                    if (isPendingPreload) {\r\n                        updateTabsState(wizardElement, isPendingPreload);\r\n                    } else {\r\n                        var isValid = validateFirstTabFields();\r\n                        updateWarningAlertVisibility(isValid);\r\n                    }\r\n                });\r\n\r\n                // Validate on change (for selects)\r\n                input.addEventListener('change', function () {\r\n                    validateField(this);\r\n                    if (isPendingPreload) {\r\n                        updateTabsState(wizardElement, isPendingPreload);\r\n                    } else {\r\n                        var isValid = validateFirstTabFields();\r\n                        updateWarningAlertVisibility(isValid);\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    // Also listen for SELECT2 initialization after wizard is created\r\n    // This handles cases where SELECT2 is initialized after the wizard\r\n    setTimeout(function () {\r\n        form.querySelectorAll('select[required]').forEach(function (selectElement) {\r\n            var $select = typeof $ !== 'undefined' ? $(selectElement) : null;\r\n            if ($select && $select.data('select2')) {\r\n                // Only add validation listener, don't interfere with SELECT2's native change event\r\n                $select.on('select2:select select2:clear', function () {\r\n                    // Small delay to ensure SELECT2 has updated the native select value\r\n                    setTimeout(function () {\r\n                        validateField(selectElement);\r\n                        if (isPendingPreload) {\r\n                            updateTabsState(wizardElement, isPendingPreload);\r\n                        } else {\r\n                            var isValid = validateFirstTabFields();\r\n                            updateWarningAlertVisibility(isValid);\r\n                        }\r\n                    }, 10);\r\n                });\r\n            }\r\n        });\r\n    }, 500);\r\n}\r\n\r\n/**\r\n * Shows a validation toast message using DotNet interop\r\n * @param {DotNetObjectReference} dotNetReference - Reference to the C# component\r\n * @param {string} message - The message to display\r\n */\r\nfunction showValidationToast(dotNetReference, message) {\r\n    if (dotNetReference && typeof dotNetReference.invokeMethodAsync === 'function') {\r\n        dotNetReference.invokeMethodAsync('ShowValidationToast', message).catch(function (error) {\r\n            console.error('Error al mostrar toast:', error);\r\n            // Fallback a alert si falla el toast\r\n            alert(message);\r\n        });\r\n    } else {\r\n        // Fallback a alert si no hay referencia DotNet\r\n        alert(message);\r\n    }\r\n}\r\n\r\n/**\r\n * Sets up navigation restrictions for \"Pendiente Precarga\" status\r\n * @param {HTMLElement} wizardElement - The wizard container element\r\n * @param {boolean} isPendingPreload - Whether the document is in \"Pendiente Precarga\" status\r\n * @param {DotNetObjectReference} dotNetReference - Reference to the C# component for showing toast\r\n */\r\nfunction setupNavigationRestrictions(wizardElement, isPendingPreload, dotNetReference) {\r\n    if (!isPendingPreload) return;\r\n\r\n    var validationMessage = 'Por favor debe completar todos los campos requeridos del documento para poder avanzar.';\r\n\r\n    // Initially disable tabs after the first one and update warning alert visibility\r\n    updateTabsState(wizardElement, isPendingPreload);\r\n    \r\n    // Also check initial state for warning alert (in case not pending preload)\r\n    if (!isPendingPreload) {\r\n        var isValid = validateFirstTabFields();\r\n        updateWarningAlertVisibility(isValid);\r\n    }\r\n\r\n    // Prevent navigation to other tabs when clicking on disabled tabs\r\n    var tabLinks = wizardElement.querySelectorAll('.nav-link');\r\n    tabLinks.forEach(function (link, index) {\r\n        if (index > 0) {\r\n            // Use capture phase to intercept before Bootstrap handles it\r\n            link.addEventListener('click', function (e) {\r\n                if (isPendingPreload && !validateFirstTabFields()) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    e.stopImmediatePropagation();\r\n                    showValidationToast(dotNetReference, validationMessage);\r\n                    return false;\r\n                }\r\n            }, true);\r\n\r\n            // Also intercept Bootstrap tab events\r\n            link.addEventListener('show.bs.tab', function (e) {\r\n                if (isPendingPreload && !validateFirstTabFields()) {\r\n                    e.preventDefault();\r\n                    showValidationToast(dotNetReference, validationMessage);\r\n                    return false;\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Intercept wizard navigation buttons\r\n    var nextButton = wizardElement.querySelector('.next a');\r\n    if (nextButton) {\r\n        // Use capture phase to intercept before wizard handles it\r\n        nextButton.addEventListener('click', function (e) {\r\n            var activeTab = wizardElement.querySelector('.nav-link.active');\r\n            if (activeTab && activeTab.getAttribute('href') === '#document-properties-step') {\r\n                if (!validateFirstTabFields()) {\r\n                    e.preventDefault();\r\n                    e.stopPropagation();\r\n                    e.stopImmediatePropagation();\r\n                    showValidationToast(dotNetReference, validationMessage);\r\n                    return false;\r\n                }\r\n            }\r\n        }, true);\r\n    }\r\n\r\n    // Intercept Bootstrap tab show event globally for this wizard\r\n    wizardElement.addEventListener('show.bs.tab', function (e) {\r\n        if (isPendingPreload) {\r\n            var targetTab = e.target;\r\n            var targetHref = targetTab.getAttribute('href');\r\n\r\n            // If trying to navigate away from first tab\r\n            if (targetHref !== '#document-properties-step') {\r\n                if (!validateFirstTabFields()) {\r\n                    e.preventDefault();\r\n                    showValidationToast(dotNetReference, validationMessage);\r\n                    return false;\r\n                }\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n/**\r\n * Initializes the edit document wizard with validation\r\n * @param {boolean} isPendingPreload - Whether the document is in \"Pendiente Precarga\" status\r\n * @param {DotNetObjectReference} dotNetReference - Reference to the C# component for showing toast\r\n */\r\nwindow.initEditDocumentWizard = function (isPendingPreload, dotNetReference) {\r\n    function initWizard() {\r\n        var wizardElement = document.getElementById('edit-document-wizard');\r\n        if (!wizardElement) {\r\n            console.warn('Wizard element not found');\r\n            return false;\r\n        }\r\n\r\n        // Check if Wizard class is available\r\n        if (typeof Wizard === 'undefined') {\r\n            console.warn('Wizard class not found, retrying...');\r\n            return false;\r\n        }\r\n\r\n        try {\r\n            // Create new wizard instance with validation\r\n            var wizard = new Wizard('#edit-document-wizard', {\r\n                validate: true\r\n            });\r\n\r\n            // Set up navigation restrictions if document is in \"Pendiente Precarga\" status\r\n            setupNavigationRestrictions(wizardElement, isPendingPreload, dotNetReference);\r\n\r\n            // Set up form validation\r\n            var form = document.getElementById('documentPropertiesForm');\r\n            if (form) {\r\n                setupFormValidation(form, isPendingPreload, wizardElement);\r\n            }\r\n\r\n            // Initial validation and tabs state update after a delay to ensure SELECT2 and Flatpickr are initialized\r\n            setTimeout(function () {\r\n                if (isPendingPreload) {\r\n                    updateTabsState(wizardElement, isPendingPreload);\r\n                } else {\r\n                    // Check initial state for warning alert visibility even if not pending preload\r\n                    var isValid = validateFirstTabFields();\r\n                    updateWarningAlertVisibility(isValid);\r\n                }\r\n                // Update save button visibility on initialization\r\n                updateSaveButtonVisibility(wizardElement);\r\n            }, 600);\r\n\r\n            // Set up event listener to update save button visibility when tab changes\r\n            setupSaveButtonVisibility(wizardElement);\r\n\r\n            console.log('Edit document wizard initialized successfully');\r\n            return true;\r\n        } catch (e) {\r\n            console.error('Error initializing wizard:', e);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    // Try to initialize immediately\r\n    if (!initWizard()) {\r\n        // If Wizard class is not available, wait a bit and try again\r\n        var attempts = 0;\r\n        var maxAttempts = 10;\r\n        var interval = setInterval(function () {\r\n            attempts++;\r\n            if (initWizard() || attempts >= maxAttempts) {\r\n                clearInterval(interval);\r\n                if (attempts >= maxAttempts && typeof Wizard === 'undefined') {\r\n                    console.error('Wizard class not found after multiple attempts');\r\n                }\r\n            }\r\n        }, 100);\r\n    }\r\n};\r\n\r\n/**\r\n * Updates the visibility of the save button based on the current active tab\r\n * @param {HTMLElement} wizardElement - The wizard container element\r\n */\r\nfunction updateSaveButtonVisibility(wizardElement) {\r\n    if (!wizardElement) return;\r\n\r\n    var saveButtonContainer = wizardElement.querySelector('.wizard .last');\r\n    if (!saveButtonContainer) return;\r\n\r\n    // Get the active tab\r\n    var activeTab = wizardElement.querySelector('.nav-link.active');\r\n    if (!activeTab) {\r\n        // Hide save button if no active tab\r\n        saveButtonContainer.style.display = 'none';\r\n        return;\r\n    }\r\n\r\n    var activeTabHref = activeTab.getAttribute('href');\r\n    \r\n    // Show save button only on the last step (notes-step)\r\n    if (activeTabHref === '#notes-step') {\r\n        saveButtonContainer.style.display = '';\r\n    } else {\r\n        saveButtonContainer.style.display = 'none';\r\n    }\r\n}\r\n\r\n/**\r\n * Sets up event listeners to update save button visibility when tabs change\r\n * @param {HTMLElement} wizardElement - The wizard container element\r\n */\r\nfunction setupSaveButtonVisibility(wizardElement) {\r\n    if (!wizardElement) return;\r\n\r\n    // Listen for Bootstrap tab show events\r\n    wizardElement.addEventListener('shown.bs.tab', function (e) {\r\n        updateSaveButtonVisibility(wizardElement);\r\n    });\r\n\r\n    // Also listen for tab click events as fallback\r\n    var tabLinks = wizardElement.querySelectorAll('.nav-link');\r\n    tabLinks.forEach(function (link) {\r\n        link.addEventListener('click', function () {\r\n            // Use setTimeout to ensure the tab has changed before updating visibility\r\n            setTimeout(function () {\r\n                updateSaveButtonVisibility(wizardElement);\r\n            }, 100);\r\n        });\r\n    });\r\n}\r\n\r\n/**\r\n * Resets the wizard to the first step\r\n */\r\nwindow.resetEditDocumentWizard = function () {\r\n    var wizardElement = document.getElementById('edit-document-wizard');\r\n    if (wizardElement) {\r\n        var firstTab = wizardElement.querySelector('.nav-link');\r\n        if (firstTab) {\r\n            var firstTabPane = document.querySelector(firstTab.getAttribute('href'));\r\n            if (firstTabPane) {\r\n                // Reset all tabs\r\n                wizardElement.querySelectorAll('.nav-link').forEach(function (link) {\r\n                    link.classList.remove('active');\r\n                });\r\n                wizardElement.querySelectorAll('.tab-pane').forEach(function (pane) {\r\n                    pane.classList.remove('show', 'active');\r\n                });\r\n                // Activate first tab\r\n                firstTab.classList.add('active');\r\n                firstTabPane.classList.add('show', 'active');\r\n                \r\n                // Update save button visibility after reset\r\n                updateSaveButtonVisibility(wizardElement);\r\n            }\r\n        }\r\n    }\r\n};\r\n"]}