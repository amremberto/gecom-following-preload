function validateFirstTabFields(){var e=document.getElementById("documentPropertiesForm");if(!e)return!1;var t=!0;return e.querySelectorAll("input[required], select[required]").forEach(function(e){if(null!==e.offsetParent&&!e.disabled)if("SELECT"===e.tagName&&"undefined"!=typeof $&&$(e).data("select2")){(i=$(e).val())&&""!==i&&null!==i?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"))}else{var i=e.value;if("caecai-edit"===e.id){var a=i.replace(/\D/g,"");i&&""!==i.trim()&&14===a.length?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.nextElementSibling&&e.nextElementSibling.classList.contains("invalid-feedback")&&(e.nextElementSibling.textContent="El nro. CAE/CAI debe tener exactamente 14 dígitos."))}else if("punto-venta-edit"===e.id){a=i.replace(/\D/g,"");i&&""!==i.trim()&&0!==a.length?a.length>5?(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.nextElementSibling&&e.nextElementSibling.classList.contains("invalid-feedback")&&(e.nextElementSibling.textContent="El punto de venta no debe tener más de 5 dígitos.")):(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.nextElementSibling&&e.nextElementSibling.classList.contains("invalid-feedback")&&(e.nextElementSibling.textContent="Por favor ingrese el punto de venta."))}else if("numero-comprobante-edit"===e.id){a=i.replace(/\D/g,"");i&&""!==i.trim()&&0!==a.length?a.length>8?(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.nextElementSibling&&e.nextElementSibling.classList.contains("invalid-feedback")&&(e.nextElementSibling.textContent="El número de comprobante no debe tener más de 8 dígitos.")):(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"),e.nextElementSibling&&e.nextElementSibling.classList.contains("invalid-feedback")&&(e.nextElementSibling.textContent="Por favor ingrese el número de comprobante."))}else if("fecha-factura-edit"===e.id||"venc-caecai-edit"===e.id){var n="fecha-factura-edit"===e.id?document.querySelector("#fecha-factura-edit"):document.querySelector("#venc-caecai-edit");if(n&&n._flatpickr){var s=n._flatpickr.altInput;if(s){var r=s.value;if(r&&""!==r.trim()){var l=!0;if("fecha-factura-edit"===e.id&&n._flatpickr.selectedDates.length>0){var o=n._flatpickr.selectedDates[0],d=new Date;d.setHours(0,0,0,0),o.setHours(0,0,0,0),o>d?(l=!1,s.setCustomValidity("La fecha de factura no puede ser mayor al día actual.")):s.setCustomValidity("")}if("venc-caecai-edit"===e.id){var c=document.querySelector("#fecha-factura-edit");if(c&&c._flatpickr&&c._flatpickr.selectedDates.length>0){o=c._flatpickr.selectedDates[0];if(n._flatpickr.selectedDates.length>0){var u=n._flatpickr.selectedDates[0];o.setHours(0,0,0,0),u.setHours(0,0,0,0),u<o?(l=!1,s.setCustomValidity("La fecha Venc. CAE/CAI no puede ser anterior a la fecha de factura.")):s.setCustomValidity("")}}}!l||s.classList.contains("is-invalid")?(t=!1,s.classList.add("is-invalid"),s.classList.remove("is-valid")):(s.classList.remove("is-invalid"),s.classList.add("is-valid"))}else t=!1,s.classList.add("is-invalid"),s.classList.remove("is-valid")}}else i&&""!==i.trim()?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"))}else"number"===e.type?!i||""===i||parseFloat(i)<=0?(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid")):(e.classList.remove("is-invalid"),e.classList.add("is-valid")):i&&""!==i.trim()?(e.classList.remove("is-invalid"),e.classList.add("is-valid")):(t=!1,e.classList.add("is-invalid"),e.classList.remove("is-valid"))}}),t}function updateTabsState(e,t){if(t){for(var i=validateFirstTabFields(),a=e.querySelectorAll(".nav-link"),n=1;n<a.length;n++)i?(a[n].classList.remove("disabled"),a[n].style.pointerEvents="",a[n].style.opacity="",a[n].style.cursor=""):(a[n].classList.add("disabled"),a[n].style.pointerEvents="none",a[n].style.opacity="0.5",a[n].style.cursor="not-allowed");updateWarningAlertVisibility(i)}}function updateWarningAlertVisibility(e){var t=document.getElementById("first-tab-warning-alert");t&&(t.style.display=e?"none":"block")}function validateCaecaiField(e){if(!e||"caecai-edit"!==e.id)return!0;var t=e.value||"",i=t.replace(/\D/g,"");if(!t||""===t.trim())return e.hasAttribute("required")?(e.setCustomValidity("Por favor ingrese el número de CAE / CAI."),e.classList.add("is-invalid"),e.classList.remove("is-valid"),!1):(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.remove("is-valid"),!0);if(14!==i.length){e.setCustomValidity("El nro. CAE/CAI debe tener exactamente 14 dígitos."),e.classList.add("is-invalid"),e.classList.remove("is-valid");var a=e.nextElementSibling;return a&&a.classList.contains("invalid-feedback")&&(a.textContent="El nro. CAE/CAI debe tener exactamente 14 dígitos."),!1}return e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.add("is-valid"),!0}function validatePuntoDeVentaField(e){if(!e||"punto-venta-edit"!==e.id)return!0;var t,i=e.value||"",a=i.replace(/\D/g,"");return i&&""!==i.trim()&&0!==a.length?a.length>5?(e.setCustomValidity("El punto de venta no debe tener más de 5 dígitos."),e.classList.add("is-invalid"),e.classList.remove("is-valid"),(t=e.nextElementSibling)&&t.classList.contains("invalid-feedback")&&(t.textContent="El punto de venta no debe tener más de 5 dígitos."),!1):(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.add("is-valid"),!0):e.hasAttribute("required")?(e.setCustomValidity("Por favor ingrese el punto de venta."),e.classList.add("is-invalid"),e.classList.remove("is-valid"),(t=e.nextElementSibling)&&t.classList.contains("invalid-feedback")&&(t.textContent="Por favor ingrese el punto de venta."),!1):(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.remove("is-valid"),!0)}function validateNumeroComprobanteField(e){if(!e||"numero-comprobante-edit"!==e.id)return!0;var t,i=e.value||"",a=i.replace(/\D/g,"");return i&&""!==i.trim()&&0!==a.length?a.length>8?(e.setCustomValidity("El número de comprobante no debe tener más de 8 dígitos."),e.classList.add("is-invalid"),e.classList.remove("is-valid"),(t=e.nextElementSibling)&&t.classList.contains("invalid-feedback")&&(t.textContent="El número de comprobante no debe tener más de 8 dígitos."),!1):(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.add("is-valid"),!0):e.hasAttribute("required")?(e.setCustomValidity("Por favor ingrese el número de comprobante."),e.classList.add("is-invalid"),e.classList.remove("is-valid"),(t=e.nextElementSibling)&&t.classList.contains("invalid-feedback")&&(t.textContent="Por favor ingrese el número de comprobante."),!1):(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.remove("is-valid"),!0)}function validateField(e){if("caecai-edit"===e.id)return validateCaecaiField(e);if("punto-venta-edit"===e.id)return validatePuntoDeVentaField(e);if("numero-comprobante-edit"===e.id)return validateNumeroComprobanteField(e);if(e.hasAttribute("required")){if("text"===e.type||"number"===e.type)return e.value&&""!==e.value.trim()?(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.checkValidity()&&e.classList.add("is-valid"),!0):(e.setCustomValidity("Este campo es obligatorio"),e.classList.add("is-invalid"),e.classList.remove("is-valid"),!1);if("SELECT"===e.tagName)return e.value&&""!==e.value?(e.setCustomValidity(""),e.classList.remove("is-invalid"),e.classList.add("is-valid"),!0):(e.setCustomValidity("Por favor seleccione una opción"),e.classList.add("is-invalid"),e.classList.remove("is-valid"),!1)}return!0}function setupFormValidation(e,t,i,a){e&&(e.querySelectorAll("input[required], select[required]").forEach(function(e){validateField(e),"SELECT"===e.tagName&&"undefined"!=typeof $&&$(e).data("select2")?$(e).on("select2:select select2:clear",function(){var e=this;setTimeout(function(){(validateField(e),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())},10)}):"caecai-edit"===e.id?(e.addEventListener("input",function(e){var a=this.value.replace(/\D/g,"");(a.length>14&&(a=a.substring(0,14)),this.value=a,validateCaecaiField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("blur",function(){(validateCaecaiField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("keypress",function(e){var t=String.fromCharCode(e.which);/[0-9]/.test(t)||e.preventDefault()})):"punto-venta-edit"===e.id?(e.addEventListener("input",function(e){var a=this.value.replace(/\D/g,"");(a.length>5&&(a=a.substring(0,5)),this.value=a,validatePuntoDeVentaField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("blur",function(){(validatePuntoDeVentaField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("keypress",function(e){var t=String.fromCharCode(e.which);/[0-9]/.test(t)||e.preventDefault()})):"numero-comprobante-edit"===e.id?(e.addEventListener("input",function(e){var a=this.value.replace(/\D/g,"");(a.length>8&&(a=a.substring(0,8)),this.value=a,validateNumeroComprobanteField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("blur",function(){(validateNumeroComprobanteField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("keypress",function(e){var t=String.fromCharCode(e.which);/[0-9]/.test(t)||e.preventDefault()})):"fecha-factura-edit"===e.id||"venc-caecai-edit"===e.id?setTimeout(function(){var a="fecha-factura-edit"===e.id?document.querySelector("#fecha-factura-edit"):document.querySelector("#venc-caecai-edit");a&&a._flatpickr&&a._flatpickr.altInput&&(a._flatpickr.altInput.addEventListener("blur",function(){(validateFirstTabFields(),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),"fecha-factura-edit"===e.id&&a._flatpickr.config.onChange.push(function(e){var a=document.querySelector("#venc-caecai-edit");a&&a._flatpickr&&e.length>0&&(a._flatpickr.set("minDate",e[0]),validateFirstTabFields(),n(),t?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields()))}))},500):(e.addEventListener("blur",function(){(validateField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("input",function(){(validateField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}),e.addEventListener("change",function(){(validateField(this),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())}))}),setTimeout(function(){e.querySelectorAll("select[required]").forEach(function(e){var a="undefined"!=typeof $?$(e):null;a&&a.data("select2")&&a.on("select2:select select2:clear",function(){setTimeout(function(){(validateField(e),n(),t)?updateTabsState(i,t):updateWarningAlertVisibility(validateFirstTabFields())},10)})})},500));function n(){var n=a?a():null,s=validateFirstTabFields(),r=!!n&&hasFormChanged(e,n),l=i.querySelectorAll(".nav-link");s?r&&!t?l.forEach(function(e,t){t>0&&(e.style.pointerEvents="none",e.style.opacity="0.5",e.style.cursor="not-allowed")}):l.forEach(function(e,i){i>0&&(!t||t&&s)&&(e.style.pointerEvents="",e.style.opacity="",e.style.cursor="")}):l.forEach(function(e,t){t>0&&(e.style.pointerEvents="none",e.style.opacity="0.5",e.style.cursor="not-allowed")})}}function showValidationToast(e,t){e&&"function"==typeof e.invokeMethodAsync?e.invokeMethodAsync("ShowValidationToast",t).catch(function(e){console.error("Error al mostrar toast:",e),alert(t)}):alert(t)}function showSuccessToast(e,t){e&&"function"==typeof e.invokeMethodAsync?e.invokeMethodAsync("ShowSuccessToast",t).catch(function(e){console.error("Error al mostrar toast:",e),alert(t)}):alert(t)}function getFormData(e){if(!e)return{};var t={};return e.querySelectorAll("input, select, textarea").forEach(function(e){var i=e.id||e.name;if(i)if("SELECT"===e.tagName&&"undefined"!=typeof $&&$(e).data("select2"))t[i]=$(e).val()||"";else if("fecha-factura-edit"===e.id||"venc-caecai-edit"===e.id)if(e._flatpickr&&e._flatpickr.selectedDates&&e._flatpickr.selectedDates.length>0){var a=e._flatpickr.selectedDates[0],n=a.getFullYear(),s=String(a.getMonth()+1).padStart(2,"0"),r=String(a.getDate()).padStart(2,"0");t[i]=n+"-"+s+"-"+r}else t[i]="";else t[i]=e.value||""}),{docId:0,sociedadCuit:t["society-select-edit"]||"",tipoDocId:t["document-type-select-edit"]?parseInt(t["document-type-select-edit"]):null,puntoDeVenta:t["punto-venta-edit"]||"",numeroComprobante:t["numero-comprobante-edit"]||"",fechaEmisionComprobante:t["fecha-factura-edit"]||null,moneda:t["currency-select-edit"]||"",montoBruto:t["monto-bruto-edit"]?parseFloat(t["monto-bruto-edit"]):null,caecai:t["caecai-edit"]||"",vencimientoCaecai:t["venc-caecai-edit"]||null}}function saveInitialFormState(e){if(!e)return{};var t={};return e.querySelectorAll("input, select, textarea").forEach(function(e){var i=e.id||e.name;i&&("SELECT"===e.tagName&&"undefined"!=typeof $&&$(e).data("select2")?t[i]=$(e).val()||"":("fecha-factura-edit"===e.id||"venc-caecai-edit"===e.id)&&e._flatpickr&&e._flatpickr.altInput?t[i]=e._flatpickr.altInput.value||"":t[i]=e.value||"")}),t}function hasFormChanged(e,t){if(!e||!t)return!1;for(var i=e.querySelectorAll("input, select, textarea"),a=0;a<i.length;a++){var n=i[a],s=n.id||n.name;if(s&&t.hasOwnProperty(s)){var r=t[s]||"";if((("SELECT"===n.tagName&&"undefined"!=typeof $&&$(n).data("select2")?$(n).val()||"":("fecha-factura-edit"===n.id||"venc-caecai-edit"===n.id)&&n._flatpickr&&n._flatpickr.altInput?n._flatpickr.altInput.value||"":n.value||"")||"").toString().trim()!==(r||"").toString().trim())return!0}}return!1}function setupNavigationRestrictions(e,t,i,a,n){var s="Por favor debe completar todos los campos requeridos del documento para poder avanzar.",r='Debe usar el botón "Siguiente" para avanzar cuando hay cambios en los campos.';(t&&updateTabsState(e,t),t)||updateWarningAlertVisibility(validateFirstTabFields());var l=!1;e.querySelectorAll(".nav-link").forEach(function(e,t){t>0&&(e.addEventListener("click",function(e){var t=document.getElementById("documentPropertiesForm");if(t){if(!validateFirstTabFields())return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),showValidationToast(i,s),!1;if(!l){var n=a?a():null;if(n&&hasFormChanged(t,n))return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),showValidationToast(i,r),!1}}},!0),e.addEventListener("show.bs.tab",function(e){var t=document.getElementById("documentPropertiesForm");if(t){if(!validateFirstTabFields())return e.preventDefault(),showValidationToast(i,s),!1;if(!l){var n=a?a():null;if(n&&hasFormChanged(t,n))return e.preventDefault(),showValidationToast(i,r),!1}}}))});var o=e.querySelector(".next a");o&&o.addEventListener("click",async function(t){var r=e.querySelector(".nav-link.active"),o=r?r.getAttribute("href"):null,d=document.getElementById("documentPropertiesForm");if(d)if("#document-properties-step"===o){if(!validateFirstTabFields())return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),showValidationToast(i,s),!1;var c=a?a():null;if(!!c&&hasFormChanged(d,c)){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var u=!1;if(i&&"function"==typeof i.invokeMethodAsync)try{u=await i.invokeMethodAsync("ShowConfirmationDialog",'Ha realizado cambios en los campos del documento. ¿Desea guardar estos cambios antes de continuar?\n\nPresione "Aceptar" para guardar y continuar, o "Cancelar" para permanecer en esta pestaña.')}catch(e){console.error("Error al mostrar diálogo de confirmación:",e),u=confirm('Ha realizado cambios en los campos del documento. ¿Desea guardar estos cambios antes de continuar?\n\nPresione "Aceptar" para guardar y continuar, o "Cancelar" para permanecer en esta pestaña.')}else u=confirm('Ha realizado cambios en los campos del documento. ¿Desea guardar estos cambios antes de continuar?\n\nPresione "Aceptar" para guardar y continuar, o "Cancelar" para permanecer en esta pestaña.');if(u)try{var v=getFormData(d),m=e.getAttribute("data-doc-id")?parseInt(e.getAttribute("data-doc-id")):0;if(!m)return showValidationToast(i,"Error: No se pudo obtener el ID del documento."),!1;if(i&&"function"==typeof i.invokeMethodAsync){var f=await i.invokeMethodAsync("UpdateDocumentFromWizard",m,v.sociedadCuit,v.tipoDocId,v.puntoDeVenta,v.numeroComprobante,v.fechaEmisionComprobante,v.moneda,v.montoBruto,v.caecai,v.vencimientoCaecai);f&&f.success?setTimeout(function(){setTimeout(function(){var t=saveInitialFormState(d);n&&n(t),showSuccessToast(i,f.message||"Documento actualizado exitosamente."),l=!0,setTimeout(function(){var t=Array.from(e.querySelectorAll(".nav-link")).indexOf(r),i=e.querySelectorAll(".nav-link")[t+1];i&&new bootstrap.Tab(i).show();setTimeout(function(){l=!1},200)},100)},500)},100):showValidationToast(i,f.message||"Error al actualizar el documento. No se pudo avanzar.")}else showValidationToast(i,"Error: No se pudo comunicar con el servidor para actualizar el documento.")}catch(e){console.error("Error al actualizar documento:",e),showValidationToast(i,"Error al actualizar el documento: "+(e.message||"Error desconocido"))}return!1}l=!0,setTimeout(function(){l=!1},100)}else l=!0,setTimeout(function(){l=!1},100)},!0),e.addEventListener("show.bs.tab",function(e){var t=document.getElementById("documentPropertiesForm");if(t&&"#document-properties-step"!==e.target.getAttribute("href")){if(!validateFirstTabFields())return e.preventDefault(),showValidationToast(i,s),!1;if(!l){var n=a?a():null;if(n&&hasFormChanged(t,n))return e.preventDefault(),showValidationToast(i,r),!1}}})}function updateSaveButtonVisibility(e){if(e){var t=e.querySelector(".wizard .last");if(t){var i=e.querySelector(".nav-link.active");if(i){var a=i.getAttribute("href");t.style.display="#notes-step"===a?"":"none"}else t.style.display="none"}}}function setupSaveButtonVisibility(e,t){e&&(e.addEventListener("shown.bs.tab",function(i){updateSaveButtonVisibility(e),"#purchase-orders-step"===i.target.getAttribute("href")&&t&&t.invokeMethodAsync("LoadSapPurchaseOrders").catch(function(e){console.error("Error loading SAP purchase orders:",e)})}),e.querySelectorAll(".nav-link").forEach(function(t){t.addEventListener("click",function(){setTimeout(function(){updateSaveButtonVisibility(e)},100)})}))}window.initEditDocumentWizard=function(e,t,i){var a={value:null},n=function(e){a.value=e};function s(){var s=document.getElementById("edit-document-wizard");if(!s)return console.warn("Wizard element not found"),!1;if("undefined"==typeof Wizard)return console.warn("Wizard class not found, retrying..."),!1;try{i&&s.setAttribute("data-doc-id",i.toString());new Wizard("#edit-document-wizard",{validate:!0});var r=document.getElementById("documentPropertiesForm");return setupNavigationRestrictions(s,e,t,function(){return a.value},n),r&&setupFormValidation(r,e,s,function(){return a.value}),setTimeout(function(){if(r){a.value=saveInitialFormState(r);var t=validateFirstTabFields(),i=s.querySelectorAll(".nav-link");t||i.forEach(function(e,t){t>0&&(e.style.pointerEvents="none",e.style.opacity="0.5",e.style.cursor="not-allowed")})}e?updateTabsState(s,e):updateWarningAlertVisibility(t=validateFirstTabFields());updateSaveButtonVisibility(s)},800),setupSaveButtonVisibility(s,t),console.log("Edit document wizard initialized successfully"),!0}catch(e){return console.error("Error initializing wizard:",e),!1}}if(!s())var r=0,l=setInterval(function(){r++,(s()||r>=10)&&(clearInterval(l),r>=10&&"undefined"==typeof Wizard&&console.error("Wizard class not found after multiple attempts"))},100)},window.resetEditDocumentWizard=function(){var e=document.getElementById("edit-document-wizard");if(e){var t=e.querySelector(".nav-link");if(t){var i=document.querySelector(t.getAttribute("href"));i&&(e.querySelectorAll(".nav-link").forEach(function(e){e.classList.remove("active")}),e.querySelectorAll(".tab-pane").forEach(function(e){e.classList.remove("show","active")}),t.classList.add("active"),i.classList.add("show","active"),updateSaveButtonVisibility(e))}}};
//# sourceMappingURL=form-wizard-edit.min.js.map
